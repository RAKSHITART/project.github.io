<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mall Store Ranking and Optimization</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        label, input, select, button {
            display: block;
            margin: 10px 0;
        }
        .section {
            margin-top: 20px;
        }
        .store-list {
            margin-top: 20px;
        }
        .store-item {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>Mall Store Ranking and Optimization</h1>
    
    <!-- Step 1: Enter store details -->
    <div id="storeDetails">
        <h2>Step 1: Enter Store Details</h2>
        <label for="numStores">Number of Stores:</label>
        <input type="number" id="numStores" min="1" required>
        <button onclick="addStoreInputs()">Submit Store Details</button>

        <div id="storeInputs"></div>
    </div>

    <!-- Step 2: Choose ranking method -->
    <div id="rankingSection" class="section" style="display:none;">
        <h2>Step 2: Choose Ranking</h2>
        <label for="rankingMethod">Choose the ranking method:</label>
        <select id="rankingMethod">
            <option value="1">Rank by Highest Reviews</option>
            <option value="2">Rank by Positive Reviews</option>
        </select>
        <button onclick="rankStores()">Rank Stores</button>
    </div>

    <!-- Step 3: Show ranked stores -->
    <div id="rankedStoresSection" class="section" style="display:none;">
        <h2>Top 3 Ranked Stores</h2>
        <div id="rankedStores"></div>
    </div>

    <!-- Step 4: Add traffic connections -->
    <div id="connectionSection" class="section" style="display:none;">
        <h2>Step 4: Add Traffic Connections</h2>
        <label for="numConnections">Number of Connections:</label>
        <input type="number" id="numConnections" min="1" required>
        <button onclick="addConnectionInputs()">Add Connections</button>

        <div id="connectionInputs"></div>
    </div>

    <!-- Step 5: Show shortest path results -->
    <div id="shortestPathsSection" class="section" style="display:none;">
        <h2>Shortest Path Results (for optimal store placement)</h2>
        <div id="shortestPaths"></div>
    </div>

    <script>
        let storeDetails = [];
        let connections = [];

        // Step 1: Collect store details
        function addStoreInputs() {
            const numStores = document.getElementById('numStores').value;
            if (numStores < 1) {
                alert("Please enter a valid number of stores.");
                return;
            }
            
            let storeInputsHTML = '';
            for (let i = 0; i < numStores; i++) {
                storeInputsHTML += `
                    <div class="store-item">
                        <label for="storeName${i}">Store ${i + 1} Name:</label>
                        <input type="text" id="storeName${i}" required>

                        <label for="storeRevenue${i}">Revenue:</label>
                        <input type="number" id="storeRevenue${i}" required>

                        <label for="storeReviews${i}">Number of Reviews:</label>
                        <input type="number" id="storeReviews${i}" required>

                        <label for="storePositiveReviews${i}">Number of Positive Reviews:</label>
                        <input type="number" id="storePositiveReviews${i}" required>
                    </div>
                `;
            }

            storeInputsHTML += '<button onclick="storeDetailsSubmission()">Submit Store Details</button>';
            document.getElementById('storeInputs').innerHTML = storeInputsHTML;
        }

        // Step 1: Collect store details submission
        function storeDetailsSubmission() {
            const numStores = document.getElementById('numStores').value;
            storeDetails = [];
            for (let i = 0; i < numStores; i++) {
                const store = {
                    name: document.getElementById(`storeName${i}`).value,
                    revenue: document.getElementById(`storeRevenue${i}`).value,
                    reviews: document.getElementById(`storeReviews${i}`).value,
                    positiveReviews: document.getElementById(`storePositiveReviews${i}`).value
                };
                storeDetails.push(store);
            }
            document.getElementById('rankingSection').style.display = 'block';
        }

        // Step 2: Rank stores based on reviews
        function rankStores() {
            const rankingMethod = document.getElementById('rankingMethod').value;
            if (rankingMethod == '1') {
                storeDetails.sort((a, b) => b.reviews - a.reviews);
            } else if (rankingMethod == '2') {
                storeDetails.sort((a, b) => b.positiveReviews - a.positiveReviews);
            }
            displayRankedStores();
        }

        // Display the ranked stores
        function displayRankedStores() {
            let rankedStoresHTML = '<ul>';
            const topStores = storeDetails.slice(0, 3);
            topStores.forEach((store, index) => {
                rankedStoresHTML += `
                    <li>
                        ${index + 1}. ${store.name} - Reviews: ${store.reviews}, Positive Reviews: ${store.positiveReviews}
                    </li>
                `;
            });
            rankedStoresHTML += '</ul>';
            document.getElementById('rankedStores').innerHTML = rankedStoresHTML;
            document.getElementById('rankedStoresSection').style.display = 'block';
            document.getElementById('connectionSection').style.display = 'block';
        }

        // Step 4: Add traffic connections
        function addConnectionInputs() {
            const numConnections = document.getElementById('numConnections').value;
            if (numConnections < 1) {
                alert("Please enter a valid number of connections.");
                return;
            }
            
            let connectionInputsHTML = '';
            for (let i = 0; i < numConnections; i++) {
                connectionInputsHTML += `
                    <div class="connection-item">
                        <label for="store1${i}">Store 1 (ID):</label>
                        <input type="number" id="store1${i}" required>

                        <label for="store2${i}">Store 2 (ID):</label>
                        <input type="number" id="store2${i}" required>

                        <label for="weight${i}">Traffic Weight (in meters):</label>
                        <input type="number" id="weight${i}" required>
                    </div>
                `;
            }

            connectionInputsHTML += '<button onclick="addConnections()">Submit Connections</button>';
            document.getElementById('connectionInputs').innerHTML = connectionInputsHTML;
        }

        // Step 4: Submit the traffic connections
        function addConnections() {
            const numConnections = document.getElementById('numConnections').value;
            connections = [];
            for (let i = 0; i < numConnections; i++) {
                const connection = {
                    store1: document.getElementById(`store1${i}`).value - 1,  // Convert to zero-index
                    store2: document.getElementById(`store2${i}`).value - 1,  // Convert to zero-index
                    weight: document.getElementById(`weight${i}`).value
                };
                connections.push(connection);
            }
            document.getElementById('shortestPathsSection').style.display = 'block';
            calculateShortestPaths();
        }

        // Step 5: Calculate shortest paths (Dijkstra's algorithm in JS)
        function calculateShortestPaths() {
            const numStores = storeDetails.length;
            let graph = Array.from({ length: numStores }, () => []);

            // Build the graph with connections
            connections.forEach(connection => {
                graph[connection.store1].push({ node: connection.store2, weight: parseInt(connection.weight) });
                graph[connection.store2].push({ node: connection.store1, weight: parseInt(connection.weight) });
            });

            // Dijkstra's Algorithm
            let dist = Array(numStores).fill(Infinity);
            let prev = Array(numStores).fill(-1);
            dist[0] = 0;  // Start from store 1 (entrance)
            let pq = [{ node: 0, dist: 0 }];
            let visited = new Set();

            while (pq.length > 0) {
                let { node, dist: d } = pq.shift();
                if (visited.has(node)) continue;
                visited.add(node);

                graph[node].forEach(neighbor => {
                    let newDist = d + neighbor.weight;
                    if (newDist < dist[neighbor.node]) {
                        dist[neighbor.node] = newDist;
                        prev[neighbor.node] = node;
                        pq.push({ node: neighbor.node, dist: newDist });
                    }
                });
            }

            // Display shortest paths
            let shortestPathsHTML = '<ul>';
            for (let i = 1; i < numStores; i++) {
                shortestPathsHTML += `
                    <li>Store ${i + 1}: Distance = ${dist[i]} meters</li>
                `;
            }
            shortestPathsHTML += '</ul>';
            document.getElementById('shortestPaths').innerHTML = shortestPathsHTML;
        }
    </script>
</body>
</html>
